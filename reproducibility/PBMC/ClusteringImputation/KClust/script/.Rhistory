suppressPackageStartupMessages(library(data.table))
suppressPackageStartupMessages(library(dplyr))
suppressPackageStartupMessages(library(Matrix))
suppressPackageStartupMessages(library(stringr))
suppressPackageStartupMessages(library(cowplot))
suppressPackageStartupMessages(library(BuenColors))
suppressPackageStartupMessages(library(irlba))
suppressPackageStartupMessages(library(ggplot2))
suppressPackageStartupMessages(library(gridExtra))
suppressPackageStartupMessages(library(patchwork))
suppressPackageStartupMessages(library(Rtsne))
library(optparse)
df <- read.table("../../TagCount/TagCount.txt", header = TRUE)
get_pca <- function(mat, rank){
# mat: peak by cell
mat <- as.matrix(mat)
mat <- 1e5 * sweep(mat, 2, colSums(mat), "/")
mat.pca <- prcomp(t(mat), rank. = rank, scale. = TRUE)
x <- as.data.frame(mat.pca$x)
return(x)
}
df.pca <- get_pca(df, rank = 50)
head(df.pca)
df.dist <- 1 - cor(df.pca)
df.dist <- 1 - cor(t(df.pca))
df.dist
tsne_out <- Rtsne(df.dist, is_distance = TRUE) # Run TSNE
df_tsne_out <- as.data.frame(tsne_out$Y)
colnames(df_tsne_out) <- c("tSNE1", "tSNE2")
df_tsne_out$Runs <- colnames(df)
anno_file <- "../../Statistics/stat.txt"
df_anno <- read.table(anno_file, header = TRUE)
df_anno <- subset(df_anno, Runs %in% colnames(df))
df_plot <- merge.data.frame(df_tsne_out, df_anno, by = "Runs")
p <- ggplot(data = df_plot,
aes(x = tSNE1, y = tSNE2, color = CellType)) +
geom_point() +
scale_color_manual(values = cols) +
theme_cowplot() +
theme(legend.title = element_blank()) +
ggtitle(opt$output_filename)
cols <- c("H1-ESC" = "#a6cee3", "BJ" = "#1f78b4",
"GM12878" = "#b2df8a", "K562" = "#33a02c",
"HL60" = "#fb9a99", "TF1" = "#e31a1c")
p <- ggplot(data = df_plot,
aes(x = tSNE1, y = tSNE2, color = CellType)) +
geom_point() +
scale_color_manual(values = cols) +
theme_cowplot() +
theme(legend.title = element_blank()) +
ggtitle(opt$output_filename)
p <- ggplot(data = df_plot,
aes(x = tSNE1, y = tSNE2, color = CellType)) +
geom_point() +
scale_color_manual(values = cols) +
theme_cowplot() +
theme(legend.title = element_blank())
p
suppressPackageStartupMessages(library(data.table))
suppressPackageStartupMessages(library(dplyr))
suppressPackageStartupMessages(library(Matrix))
suppressPackageStartupMessages(library(stringr))
suppressPackageStartupMessages(library(irlba))
?pam
??pam
?hclust
df <- read.table("../../TagCount/TagCount.txt", header = TRUE)
get_pca <- function(mat, rank){
# mat: peak by cell
mat <- as.matrix(mat)
mat <- 1e5 * sweep(mat, 2, colSums(mat), "/")
mat.pca <- prcomp(t(mat), rank. = rank, scale. = TRUE)
x <- as.data.frame(mat.pca$x)
return(x)
}
df.pca <- get_pca(df, rank = 50)
df.dist <- 1 - cor(t(df.pca))
hc <- hclust(df.dist, method = "ward.D2")
is.na(df.dist)
any(is.na(df.dist))
hc <- hclust(df.dist)
?hclust
hc <- hclust(d = dist(df.dist), method = "ward.D2")
df.dist <- as.dist(1 - cor(t(df.pca)))
pa <- pam(df.dist, k = 6, diss = TRUE,
cluster.only = TRUE)
library(cluster)
pa <- pam(df.dist, k = 6, diss = TRUE,
cluster.only = TRUE)
pa
