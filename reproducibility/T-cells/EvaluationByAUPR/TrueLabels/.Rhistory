library(ggplot2)
library(cowplot)
library(gridExtra)
df <- read.table("../../SimlatedscATAC/output/bulk_peak_celltype.txt", header = TRUE)
head(df)
df <- as.matrix(df)
df <- 1e5 * sweep(df, 2, colSums(df), "/")
head(df)
df <- as.data.frame(df)
hist(df$HSC)
hist(log10(df$HSC))
hist(log10(df$HSC+1))
hist(log10(df$HSC))
hist(df$HSC, bins=100)
?hist
hist(df$HSC, 100)
View(df)
df <- read.table("../../SimlatedscATAC/output/bulk_peak_celltype.txt", header = TRUE)
head(df)
sum(df$HSC > 1)
sum(df$MPP > 1)
sum(df$LMPP > 1)
df[df>1] <- 1
df[df<1] <- 0
head(df)
View(df)
write.table(df, file = "true_labels.txt", sep = "\t", quote = FALSE)
library(ggplot2)
library(cowplot)
library(gridExtra)
df <- read.table("../../SimlatedscATAC/output/bulk_peak_celltype.txt", header = TRUE)
colnames(df)
head(df)
df_HSC <- read.table("../../Bulk/Merged/HSC/ATAC_peaks.narrowPeak")
head(df_HSC)
df_HSC <- subset(df_HSC, select = c("V1", "V2", "V3"))
head(df_HSC)
library(GenomicRanges)
library(stringr)
str_split_fixed(rownames(df), "_")[, 1]
str_split_fixed(rownames(df), "_", n =3)[, 1]
library(ggplot2)
library(cowplot)
library(gridExtra)
library(GenomicRanges)
library(stringr)
df <- read.table("../../SimlatedscATAC/output/bulk_peak_celltype.txt", header = TRUE)
chrom <- str_split_fixed(rownames(df), "_", n = 3 )[, 1]
chrom <- str_split_fixed(rownames(df), "_", n = 3 )[, 1]
peaks_all <- GRanges(seqnames = str_split_fixed(rownames(df), "_", n = 3 )[, 1],
ranges = IRanges(start = str_split_fixed(rownames(df), "_", n = 3 )[, 2],
end = ))
head(df)
hist(df$HSC)
hist(log10(df$HSC + 1))
library(ggplot2)
library(cowplot)
library(gridExtra)
library(GenomicRanges)
library(stringr)
df <- read.table("../../SimlatedscATAC/output/bulk_peak_celltype.txt", header = TRUE)
chrom <- str_split_fixed(rownames(df), "_", n = 3 )[, 1]
chrom <- str_split_fixed(rownames(df), "_", n = 3 )[, 1]
peaks_all <- GRanges(seqnames = str_split_fixed(rownames(df), "_", n = 3 )[, 1],
ranges = IRanges(start = str_split_fixed(rownames(df), "_", n = 3 )[, 2],
end = ))
df_HSC <- read.table("../../Bulk/Merged/HSC/ATAC_peaks.narrowPeak")
df_HSC <- subset(df_HSC, select = c("V1", "V2", "V3"))
head(df_HSC)
chrom <- str_split_fixed(rownames(df), "_", n = 3 )[, 1]
start <- str_split_fixed(rownames(df), "_", n = 3 )[, 2]
end <- str_split_fixed(rownames(df), "_", n = 3 )[, 3]
chrom
chrom <- str_split_fixed(rownames(df), "_", n = 3 )[, 1]
start <- str_split_fixed(rownames(df), "_", n = 3 )[, 2]
end <- str_split_fixed(rownames(df), "_", n = 3 )[, 3]
peaks_all <- GRanges(seqnames = chrom, ranges = IRanges(start = start, end = end))
head(df)
chrom <- str_split_fixed(rownames(df), "_", n = 3 )[, 1]
start <- as.numeric(str_split_fixed(rownames(df), "_", n = 3 )[, 2])
end <- as.numeric(str_split_fixed(rownames(df), "_", n = 3 )[, 3])
peaks_all <- GRanges(seqnames = chrom, ranges = IRanges(start = start, end = end))
peaks_all
peaks_HSC <- GRanges(seqnames = df_HSC$V1,
ranges = IRanges(start = df_HSC$V2,
end = df_HSC$V2))
peaks_HSC
peaks_HSC <- GRanges(seqnames = df_HSC$V1,
ranges = IRanges(start = df_HSC$V2,
end = df_HSC$V3))
peaks_HSC
df_B <- read.table("../../Bulk/Merged/B/ATAC_peaks.narrowPeak")
df_B <- subset(df_B, select = c("V1", "V2", "V3"))
peaks_B <- GRanges(seqnames = df_B$V1,
ranges = IRanges(start = df_B$V2,
end = df_B$V3))
library(ggplot2)
library(cowplot)
library(gridExtra)
library(GenomicRanges)
library(stringr)
df <- read.table("../../SimlatedscATAC/output/bulk_peak_celltype.txt", header = TRUE)
chrom <- str_split_fixed(rownames(df), "_", n = 3 )[, 1]
start <- as.numeric(str_split_fixed(rownames(df), "_", n = 3 )[, 2])
end <- as.numeric(str_split_fixed(rownames(df), "_", n = 3 )[, 3])
peaks_all <- GRanges(seqnames = chrom, ranges = IRanges(start = start, end = end))
df_B <- read.table("../../Bulk/Merged/B/ATAC_peaks.narrowPeak")
df_B <- subset(df_B, select = c("V1", "V2", "V3"))
peaks_B <- GRanges(seqnames = df_B$V1,
ranges = IRanges(start = df_B$V2,
end = df_B$V3))
?findOverlaps
peaks_B_overlap <- findOverlaps(query = peaks_all,
subject = peaks_B,
type = "any")
head(peaks_B_overlap)
colnames(df)
celltype_list <- colnames(df)
celltype_list
for(celltype in celltype_list){
df_peaks <- read.table(sprintf("../../Bulk/Merged/%s/ATAC_peaks.narrowPeak",
celltype))
df_peaks <- subset(df_peaks, select = c("V1", "V2", "V3"))
peaks <- GRanges(seqnames = df_peaks$V1,
ranges = IRanges(start = df_peaks$V2,
end = df_peaks$V3))
peaks_overlap <- findOverlaps(query = peaks_all,
subject = peaks,
type = "any")
}
head(peaks_overlap)
peaks_overlap@from
head(peaks_overlap)
head(peaks_overlap@from)
peaks_overlap_idx <- peaks_overlap@from
celltype_list
celltype
head(df)
View(df)
df[[celltype]][peaks_overlap_idx] <- 1
head(df)
df[[celltype]][!peaks_overlap_idx] <- 0
df$CLP
peaks_overlap_idx
df[[celltype]] <- 0
df[[celltype]][peaks_overlap_idx] <- 1
head(df)
peaks_overlap_idx
View(df)
library(ggplot2)
library(cowplot)
library(gridExtra)
library(GenomicRanges)
library(stringr)
df <- read.table("../../SimlatedscATAC/output/bulk_peak_celltype.txt", header = TRUE)
chrom <- str_split_fixed(rownames(df), "_", n = 3 )[, 1]
start <- as.numeric(str_split_fixed(rownames(df), "_", n = 3 )[, 2])
end <- as.numeric(str_split_fixed(rownames(df), "_", n = 3 )[, 3])
peaks_all <- GRanges(seqnames = chrom, ranges = IRanges(start = start, end = end))
celltype_list <- colnames(df)
for(celltype in celltype_list){
df_peaks <- read.table(sprintf("../../Bulk/Merged/%s/ATAC_peaks.narrowPeak",
celltype))
df_peaks <- subset(df_peaks, select = c("V1", "V2", "V3"))
peaks <- GRanges(seqnames = df_peaks$V1,
ranges = IRanges(start = df_peaks$V2,
end = df_peaks$V3))
peaks_overlap <- findOverlaps(query = peaks_all,
subject = peaks,
type = "any")
peaks_overlap_idx <- peaks_overlap@from
df[[celltype]] <- 0
df[[celltype]][peaks_overlap_idx] <- 1
}
head(df)
View(df)
write.table(df, file = "true_labels.txt", quote = FALSE, sep = "\t")
