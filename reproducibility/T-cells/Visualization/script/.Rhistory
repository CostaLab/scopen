?data.frame
df_raw <- read.table("../../TagCount/TagCount.txt", header = TRUE)
df <- data.frame(NumofPeaks = colSums(df_raw > 0),
Runs = colnames(df_raw))
head(df)
df_stat <- data.frame(NumofPeaks = colSums(df_raw > 0),
Runs = colnames(df_raw))
print(head(df_stat))
df <- read.table("../../TagCount/TagCount.txt", header = TRUE)
get_pca <- function(mat, rank){
# mat: peak by cell
mat <- as.matrix(mat)
mat <- 1e5 * sweep(mat, 2, colSums(mat), "/")
mat.pca <- prcomp(t(mat), rank. = rank, scale. = TRUE)
x <- as.data.frame(mat.pca$x)
return(x)
}
df.pca <- get_pca(df, rank = 50)
df.dist <- 1 - cor(t(df.pca))
cols <- c("H1-ESC" = "#a6cee3", "BJ" = "#1f78b4",
"GM12878" = "#b2df8a", "K562" = "#33a02c",
"HL60" = "#fb9a99", "TF1" = "#e31a1c")
tsne_out <- Rtsne(df.dist, is_distance = TRUE) # Run TSNE
df_tsne_out <- as.data.frame(tsne_out$Y)
colnames(df_tsne_out) <- c("tSNE1", "tSNE2")
df_tsne_out$Runs <- colnames(df)
suppressPackageStartupMessages(library(data.table))
suppressPackageStartupMessages(library(dplyr))
suppressPackageStartupMessages(library(Matrix))
suppressPackageStartupMessages(library(stringr))
suppressPackageStartupMessages(library(cowplot))
suppressPackageStartupMessages(library(BuenColors))
suppressPackageStartupMessages(library(irlba))
suppressPackageStartupMessages(library(ggplot2))
suppressPackageStartupMessages(library(gridExtra))
suppressPackageStartupMessages(library(patchwork))
suppressPackageStartupMessages(library(Rtsne))
library(optparse)
tsne_out <- Rtsne(df.dist, is_distance = TRUE) # Run TSNE
df_tsne_out <- as.data.frame(tsne_out$Y)
colnames(df_tsne_out) <- c("tSNE1", "tSNE2")
df_tsne_out$Runs <- colnames(df)
anno_file <- "../../Statistics/stat.txt"
df_anno <- read.table(anno_file, header = TRUE)
df_anno <- subset(df_anno, Runs %in% colnames(df))
df_plot <- merge.data.frame(df_tsne_out, df_anno, by = "Runs")
df_plot <- merge.data.frame(df_plot, df_stat, by = "Runs")
p1 <- ggplot(data = df_plot, aes(x = tSNE1, y = tSNE2)) +
geom_point(aes(color = CellType)) +
scale_color_manual(values = cols) +
theme_cowplot() +
theme(legend.title = element_blank()) +
ggtitle(opt$output_filename)
p1 <- ggplot(data = df_plot, aes(x = tSNE1, y = tSNE2)) +
geom_point(aes(color = CellType)) +
scale_color_manual(values = cols) +
theme_cowplot() +
theme(legend.title = element_blank())
p1
head(df_plot)
df_plot$CellType
ggplot(data = df_plot, aes(x = tSNE1, y = tSNE2)) +
geom_point(aes(color = CellType)) +
scale_color_manual(values = cols) +
theme_cowplot() +
theme(legend.title = element_blank())
cols <- c("Jurkat_T_cell" = "#33a02c",
"Memory_T_cell" = "#fb9a99",
"Naive_T_cell" = "#e31a1c",
"Th17_T_cell" = "#cab2d6")
p1 <- ggplot(data = df_plot, aes(x = tSNE1, y = tSNE2)) +
geom_point(aes(color = CellType)) +
scale_color_manual(values = cols) +
theme_cowplot() +
theme(legend.title = element_blank())
p1
p2 <- ggplot(data = df_plot, aes(x = tSNE1, y = tSNE2)) +
geom_point(aes(color = log10(NumofPeaks))) +
theme_cowplot() +
ggtitle(opt$output_filename)
p2 <- ggplot(data = df_plot, aes(x = tSNE1, y = tSNE2)) +
geom_point(aes(color = log10(NumofPeaks))) +
theme_cowplot()
p2
p2
ggplot(data = df_plot, aes(x = tSNE1, y = tSNE2)) +
geom_point(aes(color = log10(NumofPeaks))) +
scale_color_brewer() +
theme_cowplot()
?scale_color_brewer
ggplot(data = df_plot, aes(x = tSNE1, y = tSNE2)) +
geom_point(aes(color = log10(NumofPeaks))) +
scale_color_brewer(palette = "YlGnBu") +
theme_cowplot()
ggplot(data = df_plot, aes(x = tSNE1, y = tSNE2)) +
geom_point(aes(color = log10(NumofPeaks))) +
scale_colour_gradient(palette = "YlGnBu") +
theme_cowplot()
p2 <- ggplot(data = df_plot, aes(x = tSNE1, y = tSNE2)) +
geom_point(aes(color = log10(NumofPeaks))) +
scale_colour_gradient() +
theme_cowplot()
p2
ggplot(data = df_plot, aes(x = tSNE1, y = tSNE2)) +
geom_point(aes(color = log10(NumofPeaks))) +
scale_colour_gradient2()
p2 <- ggplot(data = df_plot, aes(x = tSNE1, y = tSNE2)) +
geom_point(aes(color = log10(NumofPeaks))) +
scale_colour_gradientn() +
theme_cowplot()
?scale_colour_gradientn
library(viridisLite)
p2 <- ggplot(data = df_plot, aes(x = tSNE1, y = tSNE2)) +
geom_point(aes(color = log10(NumofPeaks))) +
scale_colour_gradientn(colours = viridis(n = 100)) +
theme_cowplot()
p2
p2 <- ggplot(data = df_plot, aes(x = tSNE1, y = tSNE2)) +
geom_point(aes(color = log10(NumofPeaks))) +
scale_colour_gradientn(colours = rev(viridis(n = 10))) +
theme_cowplot()
p2
p2 <- ggplot(data = df_plot, aes(x = tSNE1, y = tSNE2)) +
geom_point(aes(color = log10(NumofPeaks))) +
scale_colour_gradientn(colours = viridis(n = 256)) +
theme_cowplot()
p2
p2 <- ggplot(data = df_plot, aes(x = tSNE1, y = tSNE2)) +
geom_point(aes(color = log10(NumofPeaks))) +
scale_colour_gradientn(colours = viridis(n = 100)) +
theme_cowplot()
p2
